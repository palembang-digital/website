name: Continuous Integration
on: [pull_request, push]
jobs:
  test-ui:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v1
      with:
        node-version: '14'
    - name: Test UI
      run: make test-ui

  test-server:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-go@v2
      with:
        go-version: '1.14'
    - name: Test server
      run: make test-server

  build-push-docker-image:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set tag
      id: tags
      run: echo ::set-output name=tag::${GITHUB_REF:10}
    - name: Login to hub.docker.com
      uses: azure/docker-login@v1
      with:
        login-server: https://index.docker.io/v1/
        username: palembangdigital
        password: ${{ secrets.DOCKER_REGISTRY_PASSWORD }}
    - name: Build docker image
      run: docker build -t palembangdigital/website:${{ steps.tags.outputs.tag }} .
    - name: Push docker image
      run: docker push palembangdigital/website:${{ steps.tags.outputs.tag }}
